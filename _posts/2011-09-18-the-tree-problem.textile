---
layout: post
title: 面试题-海量树集合的唯一化
category: tech
---
p(date). 2011-09-18

h3. 问题

同一个面试叔，持续了实习面试与转正面试的一个问题，就是——有海量的文件，每个文件可以表示为一颗大规模的树，不断的输入一个系统，系统要将他们唯一保存起来。其中树的比较是可同构的，即a(b,c)与a(c,b)是相同的树。

h3. 实习面试

实习面试时考算法，先说了个排序后以遍历的方式得到唯一字符串表示，然后hash判重。被告知树的规模很大，不能这么做。
然后开始回忆好像在某篇论文上看过树的hash，但苦思良久未果。后来面试叔提示，此题没有正确答案，瞬间想起来看《集体智慧编程》中的好多解决实际问题的非ACM算法，于是开始乱搞，提了一些类随机的解决方法。
其中面试叔对挖掘文件信息评估相似度的方案比较敢兴趣，于是深入讨论至面试结束。

h3. 转正面试

转正面试时又见面试叔，要把上次讨论的问题做一个high-level的架构设计，成为一个可用的高效系统，要求输入并行，且内部分布式架构。既不会架构，又不会分布式的低端码农顿时跪下了。
后来面试中把输入的部分讨论搞定，面试叔急于走人，让我把系统架构部分写了给他，赶快呼叫程序帝发现了<a href="http://duanple.blog.163.com/blog/static/709717672011330101333271/">某牛翻译的分布式论文集</a>，猛看了几篇后匆匆赶了出来，估计面试叔看过后会笑而不语吧。

h3. 数据唯一字典系统的简单设计

* 设计图

** <img src="/image/Drawing1.png" />

* Dispatch Server

** 功能：监听接收输入数据，为每个输入指定主机群中唯一目的主机进行处理。
** 目的：负载均衡，不变性（相同输入总是分配同一主机），快速，并行，主机群的容错扩展性。
** 实现：对输入进行一致性哈希（chord算法，KAD算法等）指定目标主机，哈希函数尽量简单且易区分（比如以tree的size，height来做）

* Hash Process

** 功能：对输入数据进行哈希
** 目的：效率保证的前提下哈希值包含输入数据尽量多的信息，使之唯一化。
** 实现：设计合适的哈希函数，输入tree，输出唯一Rating。例如杨戈那篇《Hash在信息学竞赛中的一类应用》中提到的一些HASH算法。

* Map Process

** 每个map-process对应分布式文件系统中的一个chunkserver，输入为所有Hash-Process的输出Rating，输出为<key: Rating  , value: isExist >，其中isExist为1|0，代表该Rating在该chunkserver中时候出现。

* Reduce Process

** 对map的输出进行combine & reduce，其输入的值对<Rating , isExist>进行求和，即统计聚合相同Rating为<Rating , Exist-Time>，输出其中Exist-Time等于Number of ChunkServer的Rating.

